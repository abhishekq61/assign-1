{"version":3,"sources":["webpack://ShopifyPixelHelper/webpack/bootstrap","webpack://ShopifyPixelHelper/./server/scripts/shopify/ShopifyPixelHelper.ts","webpack://ShopifyPixelHelper/./server/scripts/PixelHelper.ts","webpack://ShopifyPixelHelper/./server/scripts/PredefinedEvents.ts","webpack://ShopifyPixelHelper/./server/scripts/HelperUtils.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","pixelId","this","pixelHelper","PixelHelper","init","then","x","startTracking","url","window","location","href","includes","trackProductVisit","setAddToCartListener","console","log","trackPurchaseCompleted","addToCartButton","HelperUtils","getValue","document","getElementsByName","addEventListener","trackAddToCart","product","getCurrentPageProduct","content_ids","id","getPrice","content_name","title","currency","getCurrency","num_items","checkout","Shopify","line_items","map","product_id","Number","total_price_set","shop_money","amount","quantity","reduce","a","b","currency_code","contents","split","fetch","json","price","variants","active","Promise","res","f","e","v","fbq","callMethod","apply","arguments","queue","push","_fbq","loaded","version","createElement","async","src","getElementsByTagName","parentNode","insertBefore","eventName","eventData","eventType","isPredefinedEvent","PredefinedEvents","data","track","ViewContent","assign","content_type","content_category","AddToCart","Purchase","fn"],"mappings":"sCACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QA0Df,OArDAF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,G,kUClFrD,aAEA,OAyGA,UAAS,IArGT,MAIE,eAGA,KAAKC,GACHC,KAAKC,YAAc,IAAI,EAAAC,YAAYH,GACnCC,KAAKD,QAAUA,EACfC,KAAKC,YAAYE,OAAOC,KAAKC,GACpBL,KAAKM,iBAIF,gB,yCACZ,IAAIC,EAAMC,OAAOC,SAASC,KACtBH,EAAII,SAAS,oBACTX,KAAKY,oBACXZ,KAAKa,wBAEPC,QAAQC,IAAI,OACRR,EAAII,SAAS,cAAgBJ,EAAII,SAAS,aAC5CG,QAAQC,IAAI,YACNf,KAAKgB,6BAIP,uBACN,IAAIC,EAAkB,EAAAC,YAAYC,SAAS,IAAMC,SAASC,kBAAkB,OAAO,IAC/EJ,GACFA,EAAgBK,iBAAiB,QAAS,KACxCtB,KAAKuB,mBAOL,oB,yCACJ,IAAIC,QAAgBxB,KAAKyB,8BACnBzB,KAAKC,YAAYW,kBAAkB,CACvCc,YAAa,CAACF,EAAQG,IACtB3C,MAAOgB,KAAK4B,SAASJ,GACrBK,aAAcL,EAAQM,MACtBC,SAAU/B,KAAKgC,mBAIb,iB,yCACJ,IAAIR,QAAgBxB,KAAKyB,8BACnBzB,KAAKC,YAAYsB,eAAe,CACpCG,YAAa,CAACF,EAAQG,IACtB3C,MAAOgB,KAAK4B,SAASJ,GACrBS,UAAW,EACXJ,aAAcL,EAAQM,MACtBC,SAAU/B,KAAKgC,mBAKb,yB,yCACJ,IAAIE,EAA4B,EAAAhB,YAAYC,SAAS,IAAOX,OAAe2B,QAAQD,UACnFpB,QAAQC,IAAI,MACRmB,IACFpB,QAAQC,IAAI,YACNf,KAAKC,YAAYe,uBAAuB,CAC5CU,YAAaQ,EAASE,WAAWC,IAAIhC,GAAKA,EAAEiC,YAC5CtD,MAAOuD,OAAOL,EAASM,gBAAgBC,WAAWC,QAClDT,UAAWC,EAASE,WAAWC,IAAIhC,GAAKA,EAAEsC,UAAUC,OAAO,CAACC,EAAGC,IAAMD,EAAIC,EAAG,GAC5EjB,aAAc,KACdE,SAAUG,EAASM,gBAAgBC,WAAWM,cAC9CC,SAASd,EAASE,WAAWC,IAAIhC,IACxB,CACLsB,GAAGtB,EAAEiC,WACLK,SAAStC,EAAEsC,kBAOf,wB,yCACJ,IAAIpC,EAAMC,OAAOC,SAASC,KAAKuC,MAAM,KAAK,GAE1C,mBAD4BC,MAAM3C,EAAM,UAAU4C,QAAQ3B,WAI5D,SAASA,GACP,IAAI4B,EAAQ,EAAAlC,YAAYC,SAAS,IAAMK,EAAQ6B,SAAS,GAAGD,OAC3D,GAAIA,EACF,OAAOb,OAAOa,GAKlB,cACE,OAAO,EAAAlC,YAAYC,SAAS,IAAOX,OAAe2B,QAAQJ,SAASuB,W,iXCvGvE,aAGA,oBACE,YAAoBvD,GAAA,KAAAA,UAGpB,OACE,OAAO,IAAIwD,QAASC,IACD,IAACC,EAAGX,EAAGY,EAAGC,EAAGnE,EAAGP,EAAGa,EAAlB2D,EAiBPjD,OAjBUsC,EAiBK1B,SAjBFsC,EAiBY,SAjBTC,EAkBzB,iDAlB4BnE,EAkBsB,KAlBnBP,EAkByB,KAlBtBa,EAkB4B,KAjB1D2D,EAAEG,MACNpE,EAAIiE,EAAEG,IAAM,WACVpE,EAAEqE,WACArE,EAAEqE,WAAWC,MAAMtE,EAAGuE,WAAavE,EAAEwE,MAAMC,KAAKF,YAE/CN,EAAES,OAAMT,EAAES,KAAO1E,GACtBA,EAAEyE,KAAOzE,EACTA,EAAE2E,QAAS,EACX3E,EAAE4E,QAAU,MACZ5E,EAAEwE,MAAQ,IACV/E,EAAI6D,EAAEuB,cAAcX,IAClBY,OAAQ,EACVrF,EAAEsF,IAAMZ,GACR7D,EAAIgD,EAAE0B,qBAAqBd,GAAG,IAC5Be,WAAWC,aAAazF,EAAGa,IAI/BE,KAAK4D,IAAI,OAAQ5D,KAAKD,SACtBC,KAAK4D,IAAI,QAAS,YAClBJ,MAKJ,MAAMmB,EAAmBC,GACvB,IACIC,EAAY,GAEdA,EAHiB7E,KAAK8E,kBAAkBH,GAG5B,cAEA,oBAEdE,EAAY,QACZ/D,QAAQC,IAAI8D,EAAW7E,KAAKD,QAAS4E,EAAWC,GAChD5E,KAAK4D,IAAIiB,EAAWF,EAAWC,GAGjC,UACE,OAAQpE,OAAeoD,IAGzB,kBAAkBe,GAChB,QAAS,EAAAI,iBAAiBJ,GAItB,kBAAkBK,G,yCAMtBhF,KAAKiF,MAAM,EAAAF,iBAAiB,EAAAA,iBAAiBG,aAC3CzG,OAAO0G,OAAOH,EAAM,CAClBI,aAAc,gBACdC,iBAAkB,WAKlB,eAAeL,G,yCAOnBhF,KAAKiF,MAAM,EAAAF,iBAAiB,EAAAA,iBAAiBO,WAC3C7G,OAAO0G,OAAOH,EAAM,CAClBI,aAAc,gBACdC,iBAAkB,WAKlB,uBAAuBL,G,yCAW3BhF,KAAKiF,MAAM,EAAAF,iBAAiB,EAAAA,iBAAiBQ,UAC3C9G,OAAO0G,OAAOH,EAAM,CAClBI,aAAc,gBACdC,iBAAkB,c,8ECpG1B,SAAYN,GACV,uCACA,6BACA,qCACA,mDACA,yBACA,2CACA,uBACA,mCACA,2CACA,oBACA,4BACA,4BACA,wBACA,gCACA,8CACA,8BACA,kCAjBF,CAAY,EAAAA,mBAAA,EAAAA,iBAAgB,M,8ECA5B,oBACE,gBAAsBS,GACpB,IAEE,OADYA,IAEZ,MAAO9B,GACP","file":"index.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import {PixelHelper} from \"../PixelHelper\";\nimport {PredefinedEvents} from \"../PredefinedEvents\";\nimport {HelperUtils} from \"../HelperUtils\";\nimport {add} from \"winston\";\nimport {ShopifyCheckout} from \"./ShopifyCheckout\";\n\nclass ShopifyPixelHelper {\n  private pixelHelper: PixelHelper;\n  private pixelId: string;\n\n  constructor() {\n  }\n\n  init(pixelId: string) {\n    this.pixelHelper = new PixelHelper(pixelId);\n    this.pixelId = pixelId;\n    this.pixelHelper.init().then(x => {\n      return this.startTracking();\n    })\n  }\n\n  private async startTracking() {\n    let url = window.location.href;\n    if (url.includes(\"products\")) {\n      await this.trackProductVisit()\n      this.setAddToCartListener()\n    }\n    console.log(\"a1\")\n    if (url.includes(\"thank_you\") || url.includes(\"orders\")) {\n      console.log(\"a2\")\n      await this.trackPurchaseCompleted()\n    }\n  }\n\n  private setAddToCartListener() {\n    let addToCartButton = HelperUtils.getValue(() => document.getElementsByName('add')[0])\n    if (addToCartButton) {\n      addToCartButton.addEventListener('click', () => {\n        this.trackAddToCart();\n      })\n    }\n  }\n\n\n\n  async trackProductVisit() {\n    let product = await this.getCurrentPageProduct()\n    await this.pixelHelper.trackProductVisit({\n      content_ids: [product.id],\n      value: this.getPrice(product),\n      content_name: product.title,\n      currency: this.getCurrency()\n    })\n  }\n\n  async trackAddToCart() {\n    let product = await this.getCurrentPageProduct()\n    await this.pixelHelper.trackAddToCart({\n      content_ids: [product.id],\n      value: this.getPrice(product),\n      num_items: 1,\n      content_name: product.title,\n      currency: this.getCurrency()\n    })\n  }\n\n\n  async trackPurchaseCompleted() {\n    let checkout: ShopifyCheckout = HelperUtils.getValue(() => (window as any).Shopify.checkout);\n    console.log(\"a3\")\n    if (checkout) {\n      console.log(\"a4\")\n      await this.pixelHelper.trackPurchaseCompleted({\n        content_ids: checkout.line_items.map(x => x.product_id),\n        value: Number(checkout.total_price_set.shop_money.amount),\n        num_items: checkout.line_items.map(x => x.quantity).reduce((a, b) => a + b, 0),\n        content_name: null,\n        currency: checkout.total_price_set.shop_money.currency_code,\n        contents:checkout.line_items.map(x =>{\n          return {\n            id:x.product_id,\n            quantity:x.quantity\n          }\n        })\n      })\n    }\n  }\n\n  async getCurrentPageProduct(): Promise<ShopifyProduct> {\n    let url = window.location.href.split('?')[0]\n    let product = (await (await fetch(url + \".json\")).json()).product;\n    return product;\n  }\n\n  getPrice(product: ShopifyProduct) {\n    let price = HelperUtils.getValue(() => product.variants[0].price);\n    if (price) {\n      return Number(price);\n    }\n    return;\n  }\n\n  getCurrency() {\n    return HelperUtils.getValue(() => (window as any).Shopify.currency.active);\n  }\n}\n\nexport = new ShopifyPixelHelper();\n","import {PredefinedEvents} from \"./PredefinedEvents\";\nimport {PixelAttributes} from \"./PixelAttributes\";\n\nexport class PixelHelper {\n  constructor(private pixelId) {\n  }\n\n  init() {\n    return new Promise((res) => {\n      let fbFunction = (f, b, e, v, n, t, s) => {\n        if (f.fbq) return;\n        n = f.fbq = function () {\n          n.callMethod ?\n            n.callMethod.apply(n, arguments) : n.queue.push(arguments)\n        };\n        if (!f._fbq) f._fbq = n;\n        n.push = n;\n        n.loaded = !0;\n        n.version = '2.0';\n        n.queue = [];\n        t = b.createElement(e);\n        t.async = !0;\n        t.src = v;\n        s = b.getElementsByTagName(e)[0];\n        s.parentNode.insertBefore(t, s)\n      };\n      fbFunction(window as any, document, 'script',\n        'https://connect.facebook.net/en_US/fbevents.js', null, null, null);\n      this.fbq('init', this.pixelId);\n      this.fbq('track', 'PageView');\n      res();\n    })\n\n  }\n\n  track(eventName: string, eventData: PixelAttributes) {\n    let isPredefined = this.isPredefinedEvent(eventName);\n    let eventType = '';\n    if (isPredefined) {\n      eventType = 'trackSingle';\n    } else {\n      eventType = 'trackSingleCustom';\n    }\n    eventType = 'track'\n    console.log(eventType, this.pixelId, eventName, eventData)\n    this.fbq(eventType, eventName, eventData);\n  }\n\n  get fbq() {\n    return (window as any).fbq;\n  }\n\n  isPredefinedEvent(eventName: any) {\n    return !!PredefinedEvents[eventName]\n  }\n\n  //todo what is currency? shopcurrency or presentment currency\n  async trackProductVisit(data: {\n    content_ids: number[],\n    value: number,\n    content_name: string\n    currency: string\n  }) {\n    this.track(PredefinedEvents[PredefinedEvents.ViewContent],\n      Object.assign(data, {\n        content_type: \"product_group\",\n        content_category: null\n      }))\n  }\n\n//todo : get count\n  async trackAddToCart(data: {\n    content_ids: number[]\n    value: number\n    num_items: number\n    content_name: string\n    currency: string\n  }) {\n    this.track(PredefinedEvents[PredefinedEvents.AddToCart],\n      Object.assign(data, {\n        content_type: \"product_group\",\n        content_category: null\n      }))\n  }\n\n  //todo: content name\n  async trackPurchaseCompleted(data: {\n    content_ids: number[]\n    value: number\n    num_items: number\n    content_name: string\n    currency: string\n    contents: {\n      id: string,\n      quantity: number\n    }[]\n  }) {\n    this.track(PredefinedEvents[PredefinedEvents.Purchase],\n      Object.assign(data, {\n        content_type: \"product_group\",\n        content_category: null\n      }))\n  }\n}\n","export enum PredefinedEvents{\n  AddPaymentInfo=1,\n  AddToCart,\n  AddToWishlist,\n  CompleteRegistration,\n  Contact,\n  CustomizeProduct,\n  Donate,\n  FindLocation,\n  InitiateCheckout,\n  Lead,\n  Purchase,\n  Schedule,\n  Search,\n  StartTrial,\n  SubmitApplication,\n  Subscribe,\n  ViewContent\n}\n","export class HelperUtils{\n  static getValue<T, Z>(fn: () => T) {\n    try {\n      let value = fn();\n      return value;\n    } catch (e) {\n      return;\n\n    }\n  }\n}\n"],"sourceRoot":""}