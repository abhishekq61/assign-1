window.ShopifyPixelHelper=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function c(e){try{s(i.next(e))}catch(e){o(e)}}function u(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(c,u)}s((i=i.apply(e,t||[])).next())}))};const r=n(1),o=n(3);e.exports=new class{constructor(){}init(e){this.pixelHelper=new r.PixelHelper(e),this.pixelId=e,this.pixelHelper.init().then(e=>this.startTracking())}startTracking(){return i(this,void 0,void 0,(function*(){let e=window.location.href;e.includes("products")&&(yield this.trackProductVisit(),this.setAddToCartListener()),console.log("a1"),(e.includes("thank_you")||e.includes("orders"))&&(console.log("a2"),yield this.trackPurchaseCompleted())}))}setAddToCartListener(){let e=o.HelperUtils.getValue(()=>document.getElementsByName("add")[0]);e&&e.addEventListener("click",()=>{this.trackAddToCart()})}trackProductVisit(){return i(this,void 0,void 0,(function*(){let e=yield this.getCurrentPageProduct();yield this.pixelHelper.trackProductVisit({content_ids:[e.id],value:this.getPrice(e),content_name:e.title,currency:this.getCurrency()})}))}trackAddToCart(){return i(this,void 0,void 0,(function*(){let e=yield this.getCurrentPageProduct();yield this.pixelHelper.trackAddToCart({content_ids:[e.id],value:this.getPrice(e),num_items:1,content_name:e.title,currency:this.getCurrency()})}))}trackPurchaseCompleted(){return i(this,void 0,void 0,(function*(){let e=o.HelperUtils.getValue(()=>window.Shopify.checkout);console.log("a3"),e&&(console.log("a4"),yield this.pixelHelper.trackPurchaseCompleted({content_ids:e.line_items.map(e=>e.product_id),value:Number(e.total_price_set.shop_money.amount),num_items:e.line_items.map(e=>e.quantity).reduce((e,t)=>e+t,0),content_name:null,currency:e.total_price_set.shop_money.currency_code,contents:e.line_items.map(e=>({id:e.product_id,quantity:e.quantity}))}))}))}getCurrentPageProduct(){return i(this,void 0,void 0,(function*(){let e=window.location.href.split("?")[0];return(yield(yield fetch(e+".json")).json()).product}))}getPrice(e){let t=o.HelperUtils.getValue(()=>e.variants[0].price);if(t)return Number(t)}getCurrency(){return o.HelperUtils.getValue(()=>window.Shopify.currency.active)}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function c(e){try{s(i.next(e))}catch(e){o(e)}}function u(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(c,u)}s((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);t.PixelHelper=class{constructor(e){this.pixelId=e}init(){return new Promise(e=>{var t,n,i,r,o,c,u;t=window,n=document,i="script",r="https://connect.facebook.net/en_US/fbevents.js",o=null,c=null,u=null,t.fbq||(o=t.fbq=function(){o.callMethod?o.callMethod.apply(o,arguments):o.queue.push(arguments)},t._fbq||(t._fbq=o),o.push=o,o.loaded=!0,o.version="2.0",o.queue=[],(c=n.createElement(i)).async=!0,c.src=r,(u=n.getElementsByTagName(i)[0]).parentNode.insertBefore(c,u)),this.fbq("init",this.pixelId),this.fbq("track","PageView"),e()})}track(e,t){let n="";n=this.isPredefinedEvent(e)?"trackSingle":"trackSingleCustom",n="track",console.log(n,this.pixelId,e,t),this.fbq(n,e,t)}get fbq(){return window.fbq}isPredefinedEvent(e){return!!r.PredefinedEvents[e]}trackProductVisit(e){return i(this,void 0,void 0,(function*(){this.track(r.PredefinedEvents[r.PredefinedEvents.ViewContent],Object.assign(e,{content_type:"product_group",content_category:null}))}))}trackAddToCart(e){return i(this,void 0,void 0,(function*(){this.track(r.PredefinedEvents[r.PredefinedEvents.AddToCart],Object.assign(e,{content_type:"product_group",content_category:null}))}))}trackPurchaseCompleted(e){return i(this,void 0,void 0,(function*(){this.track(r.PredefinedEvents[r.PredefinedEvents.Purchase],Object.assign(e,{content_type:"product_group",content_category:null}))}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AddPaymentInfo=1]="AddPaymentInfo",e[e.AddToCart=2]="AddToCart",e[e.AddToWishlist=3]="AddToWishlist",e[e.CompleteRegistration=4]="CompleteRegistration",e[e.Contact=5]="Contact",e[e.CustomizeProduct=6]="CustomizeProduct",e[e.Donate=7]="Donate",e[e.FindLocation=8]="FindLocation",e[e.InitiateCheckout=9]="InitiateCheckout",e[e.Lead=10]="Lead",e[e.Purchase=11]="Purchase",e[e.Schedule=12]="Schedule",e[e.Search=13]="Search",e[e.StartTrial=14]="StartTrial",e[e.SubmitApplication=15]="SubmitApplication",e[e.Subscribe=16]="Subscribe",e[e.ViewContent=17]="ViewContent"}(t.PredefinedEvents||(t.PredefinedEvents={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HelperUtils=class{static getValue(e){try{return e()}catch(e){return}}}}]);
//# sourceMappingURL=index.min.js.map